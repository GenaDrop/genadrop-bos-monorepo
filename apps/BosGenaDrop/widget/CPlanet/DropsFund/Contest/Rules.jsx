const bellIcon = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="72"
    height="72"
    viewBox="0 0 72 72"
    fill="none"
  >
    <rect x="0.5" y="0.5" width="71" height="71" rx="35.5" stroke="black" />
    <path
      d="M54 35C54 33.5231 53.1906 32.2475 52 31.555V22.0006C52 21.4537 51.5638 20 50 20C49.555 20 49.1131 20.1487 48.7512 20.4387L43.4369 24.6906C40.7675 26.8244 37.4163 28 34 28H22C19.7906 28 18 29.7906 18 32V38C18 40.2094 19.7906 42 22 42H24.1062C24.0194 42.655 23.97 43.3212 23.97 44C23.97 46.4856 24.5487 48.8344 25.5675 50.9337C25.8919 51.6019 26.6 52 27.3425 52H31.985C33.6131 52 34.5906 50.135 33.6038 48.84C32.5788 47.495 31.9694 45.8175 31.9694 44C31.9694 43.3056 32.0706 42.6381 32.245 42H34C37.4163 42 40.7675 43.1756 43.4363 45.3094L48.7506 49.5612C49.1051 49.8449 49.5454 49.9996 49.9994 50C51.5569 50 51.9994 48.5762 51.9994 48V38.4456C53.1906 37.7525 54 36.4769 54 35ZM48 43.8387L45.9344 42.1862C42.5594 39.4862 38.32 38 34 38V32C38.32 32 42.5594 30.5137 45.9344 27.8137L48 26.1612V43.8387Z"
      fill="black"
    />
  </svg>
);

const checkIcon = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
  >
    <path
      d="M24 12C24 18.6274 18.6274 24 12 24C5.37256 24 0 18.6274 0 12C0 5.37256 5.37256 0 12 0C18.6274 0 24 5.37256 24 12ZM10.612 18.3539L19.5152 9.45068C19.8175 9.14835 19.8175 8.65814 19.5152 8.35582L18.4203 7.26097C18.118 6.9586 17.6278 6.9586 17.3254 7.26097L10.0645 14.5218L6.67456 11.1319C6.37224 10.8296 5.88203 10.8296 5.57966 11.1319L4.48481 12.2267C4.18248 12.5291 4.18248 13.0193 4.48481 13.3216L9.51706 18.3539C9.81944 18.6562 10.3096 18.6562 10.612 18.3539Z"
      fill="#B0B0B0"
    />
  </svg>
);

const personIcon = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
  >
    <g clip-path="url(#clip0_99_16349)">
      <path
        d="M17.2453 15.4575C17.0287 15.7059 16.7869 15.9309 16.5 16.0973V17.1727C19.6181 17.6105 21.75 18.4875 21.75 19.5C21.75 20.9498 17.385 22.125 12 22.125C6.615 22.125 2.25 20.9498 2.25 19.5C2.25 18.4875 4.38188 17.6109 7.5 17.1727V16.0973C7.21313 15.9309 6.97125 15.7059 6.75469 15.4575C2.75953 16.1878 0 17.7211 0 19.5C0 21.9853 5.37281 24 12 24C18.6272 24 24 21.9853 24 19.5C24 17.7211 21.2405 16.1878 17.2453 15.4575ZM12 6C13.657 6 15 4.65703 15 3C15 1.34297 13.657 0 12 0C10.343 0 9 1.34297 9 3C9 4.65703 10.343 6 12 6ZM9 15V19.5C9 20.3283 9.67172 21 10.5 21H13.5C14.3283 21 15 20.3283 15 19.5V15C15.8283 15 16.5 14.3283 16.5 13.5V9C16.5 7.75734 15.4927 6.75 14.25 6.75H13.6969C13.178 6.98578 12.6066 7.125 12 7.125C11.3934 7.125 10.822 6.98578 10.3031 6.75H9.75C8.50734 6.75 7.5 7.75734 7.5 9V13.5C7.5 14.3283 8.17172 15 9 15Z"
        fill="#B0B0B0"
      />
    </g>
    <defs>
      <clipPath id="clip0_99_16349">
        <rect width="24" height="24" fill="white" />
      </clipPath>
    </defs>
  </svg>
);

const greyIcon = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="18"
    height="18"
    viewBox="0 0 18 18"
    fill="none"
  >
    <circle cx="9" cy="9" r="12" fill="#B0B0B0" />
  </svg>
);

const markIcon = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="8"
    height="24"
    viewBox="0 0 8 24"
    fill="none"
  >
    <path
      d="M7.5 20.25C7.5 22.3177 5.81775 24 3.75 24C1.68225 24 0 22.3177 0 20.25C0 18.1823 1.68225 16.5 3.75 16.5C5.81775 16.5 7.5 18.1823 7.5 20.25ZM0.434063 1.1812L1.07156 13.9312C1.10152 14.5299 1.59567 15 2.19516 15H5.30484C5.90433 15 6.39848 14.5299 6.42844 13.9312L7.06594 1.1812C7.09805 0.538594 6.58575 0 5.94234 0H1.55766C0.91425 0 0.401953 0.538594 0.434063 1.1812Z"
      fill="#B0B0B0"
    />
  </svg>
);

const voteIcon = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
  >
    <path
      d="M22.8 14.8H20.4V17.2H21.24C21.4388 17.2 21.6 17.335 21.6 17.5V18.1C21.6 18.265 21.4388 18.4 21.24 18.4H2.76C2.56125 18.4 2.4 18.265 2.4 18.1V17.5C2.4 17.335 2.56125 17.2 2.76 17.2H3.6V14.8H1.2C0.53625 14.8 0 15.3362 0 16V19.6C0 20.2637 0.53625 20.8 1.2 20.8H22.8C23.4638 20.8 24 20.2637 24 19.6V16C24 15.3362 23.4638 14.8 22.8 14.8ZM19.2 17.2V5.21125C19.2 4.54 18.6563 4 17.9888 4H6.015C5.34375 4 4.8 4.54375 4.8 5.21125V17.2H19.2ZM7.92 10.375L8.87625 9.42625C9.03375 9.26875 9.28875 9.26875 9.44625 9.43L10.995 10.99L14.565 7.45C14.7225 7.2925 14.9775 7.2925 15.135 7.45375L16.0837 8.41C16.2413 8.5675 16.2413 8.8225 16.08 8.98L11.2688 13.75C11.1113 13.9075 10.8562 13.9075 10.6987 13.7462L7.92 10.945C7.75875 10.7875 7.7625 10.5325 7.92 10.375Z"
      fill="#B0B0B0"
    />
  </svg>
);

const greenCheck = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="72"
    height="72"
    viewBox="0 0 72 72"
    fill="none"
  >
    <rect x="0.5" y="0.5" width="71" height="71" rx="35.5" stroke="#3BD07F" />
    <path
      d="M72 36C72 55.8823 55.8823 72 36 72C16.1177 72 0 55.8823 0 36C0 16.1177 16.1177 0 36 0C55.8823 0 72 16.1177 72 36Z"
      fill="#3BD07F"
    />
    <path
      d="M52.5021 29.2321L32.9521 48.5091C32.2882 49.1637 31.2118 49.1637 30.5479 48.509L19.4979 37.6133C18.834 36.9587 18.834 35.8973 19.4979 35.2427L21.902 32.8722C22.566 32.2176 23.6424 32.2176 24.3062 32.8722L31.75 40.212L47.6938 24.491C48.3577 23.8363 49.4341 23.8363 50.098 24.491L52.5021 26.8616C53.166 27.5161 53.166 28.5775 52.5021 29.2321Z"
      fill="#E4FFF0"
    />
  </svg>
);

const ContainerOne = styled.div`
  display: flex;
  padding: 16px;
  flex-direction: column;
  align-items: center;
  border-radius: 8px;
  border: 1px solid #eaeaea;
  background: #fff;
  gap: 16px;
  width: 392px;
`;

const HeadCard = styled.div`
  display: flex;
  flex-direction: row;
  .top {
    display: flex;
    align-items: flex-start;
    height: 88px;
    border-bottom: 1px solid #b0b0b0;
    svg {
      margin-right: 10px;
    }
  }
  div {
    h1 {
      color: #000;
      leading-trim: both;
      margin-top: 20px;
      text-edge: cap;
      font-family: Helvetica Neue;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: normal;
      margin-bottom: 0;
    }
    p {
      color: #000;
      leading-trim: both;
      text-edge: cap;
      font-family: Helvetica Neue;
      font-size: 16px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
    }
  }
`;

const Body = styled.div`
  display: flex;
  flex-direction: column;
  .line {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-bottom: 28px;
    svg {
      width: 50px;
    }
    p {
      color: #b0b0b0;
      font-family: Helvetica Neue;
      font-size: 16px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
      margin: 0;
      margin-left: 20px;
    }
  }
`;

const ContainerTwo = styled.div`
  width: 400px;
  display: flex;
  width: 392px;
  margin-top: 24px;
  padding: 24px 16px;
  flex-direction: column;
  align-items: flex-start;
  gap: 24px;
  border-radius: 8px;
  border: 1px solid #eaeaea;
  background: #fff;
  h1 {
    color: #000;
    leading-trim: both;
    text-edge: cap;
    font-family: Helvetica Neue;
    font-size: 24px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
  }
  div {
    display: flex;
    width: 360px;
    padding: 8px 0px;
    flex-direction: column;
    align-items: center;
    border-radius: 8px;
    border: 1px solid #b0b0b0;
    background: #f8f8f8;
    p {
      color: #b0b0b0;
      text-align: center;
      font-family: Helvetica Neue;
      font-size: 20px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
    }
  }
  .submitButton {
    display: flex;
    width: 360px;
    padding: 8px 0px;
    flex-direction: column;
    align-items: center;
    border-radius: 8px;
    background: #000;
    color: white;
  }
`;

const ContainerThree = styled.div`
  display: flex;
  flex-direction: row;
  width: 392px;
  padding: 16px;
  align-items: flex-start;
  gap: 16px;
  border-radius: 8px;
  border: 1px solid #3bd07f;
  background: #e4fff0;
  margin-top: 24px;
  div {
    h1 {
      color: #3bd07f;
      leading-trim: both;
      text-edge: cap;
      font-family: Helvetica Neue;
      font-size: 24px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
    }
    span {
      color: #3bd07f;
      leading-trim: both;
      text-edge: cap;
      font-family: Helvetica Neue;
      font-size: 16px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
    }
  }
`;

const Popup = styled.div`
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;

  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px); /* Apply background blur */
`;

const PopupContent = styled.div`
  background-color: #fff;
  padding: 20px;
  border-radius: 5px;
  align-items: center;
  max-width: 750px;
  height: 500px;
  display: flex;
  flex-direction: column;
  width: 100%;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  .cancel-button {
    display: flex;

    width: 100%;
    flex-direction: row-reverse;
    h1 {
      cursor: pointer;
      font-weight: 900;
      font-size: 24px;
    }
  }
}
.submit-header {
  h1 {
    font-size: 25px;
    text-transform: uppercase;
    font-weight: 700;
  }
}
`;

const Participants = styled.div`
  background: white;
  display: flex;
  flex-direction: column;
  width: 392px;
  margin-top: 20px;
  padding: 16px;
  align-items: flex-start;
  gap: 16px;
  h1 {
    color: #000;
    leading-trim: both;
    text-edge: cap;
    font-family: Helvetica Neue;
    font-size: 24px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
  }
`;

const NoVote = styled.div`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  p {
    color: #b0b0b0;
  }
`

const [openModal, setOpenModal] = useState(false);
const testContract = props.testContract || false;

const handleArtSelection = (nft_data) => {
  Near.call(
    testContract ? "fund-beta.genadrop.near" : "contest.genadrop.near",
    "submit_art",
    {
      nft_contract_id: nft_data.contractId,
      token_id: nft_data.tokenId.toString(),
      contest_id: Number(props.contestId),
    },
    "75000000000000",
    "10000000000000000000000"
  );
  setOpenModal(false);
};

const totalUsersVoted = Near.view(
  testContract ? "fund-beta.genadrop.near" : "contest.genadrop.near",
  "get_all_user_voted",
  {
    subscribe: true,
    contest_id: Number(props.contestId),
  }
);


const handleFinalize = () => {
  Near.call(
    testContract ? "fund-beta.genadrop.near" : "contest.genadrop.near",
    "finalise_contest",
    {
      contest_id: Number(props.contestId),
    },
    "300000000000000",
    "10000000000000000000000"
  );
};

const userVoted = totalUsersVoted.includes(context.accountId)


return (
  <>
    <ContainerOne>
      <HeadCard>
        <div className="top">
          {bellIcon}
          <div>
            <h1>Accepting Submissions</h1>
            <p>Until November 20, 2023</p>
          </div>
        </div>
      </HeadCard>
      <Body>
        <div className="line">
          {checkIcon}
          <p>Creatives DAO Members Allowed</p>
        </div>
        <div className="line">
          {personIcon}
          <p>1 Submission Per CDAO Member</p>
        </div>
        <div className="line">
          {greyIcon}
          <p>Your NFT Must Be Minted On NEAR</p>
        </div>
        <div className="line">
          {markIcon}
          <p>NFTs Are Disqualified If Transferred</p>
        </div>
        <div className="line">
          {voteIcon}
          <p>Only 1 Vote per voter allowed</p>
        </div>
      </Body>
    </ContainerOne>
    <ContainerTwo>
      <h1>Submit Your NFT</h1>
      {!props.isClosed &&
      props.isOpen &&
      !props.userSubmitted &&
      context.accountId ? (
        <button onClick={() => setOpenModal(true)} className="submitButton">
          Submit Art
        </button>
      ) : props?.isClosed && props?.winners?.length === 0 && props.usersArts.length ? (
        <button className="submitButton" onClick={handleFinalize}>
          Finalize Contest
        </button>
      ) : (
        <div>
          <span>
            {props.isClosed
              ? "The Contest is Over"
              : props.userSubmitted
              ? "You have Submitted"
              : props.isOpen
              ? "Submission Started (Please connect Wallet)"
              : "Submission Ended"}
          </span>
        </div>
      )}
    </ContainerTwo>
    {openModal && (
      <Popup>
        <PopupContent>
          <div className="cancel-button">
            <h1 role="button" onClick={() => setOpenModal(false)}>
              X
            </h1>
          </div>
          <div className="submit-header">
            <h1>Choose your NFT to Submit</h1>
          </div>
          <div className="select-nft">
            <Widget
              src="agwaze.near/widget/nft-selector"
              props={{
                accountId: context.accountId,
                onChange: handleArtSelection,
              }}
            />
          </div>
        </PopupContent>
      </Popup>
    )}
    {props.userSubmitted && !props.isClosed && (
      <ContainerThree>
        {greenCheck}
        <div>
          <h1>Congratulations</h1>
          <span>Your NFT has been submitted</span>
        </div>
      </ContainerThree>
    )}
    {userVoted && !props.isClosed && (
      <ContainerThree>
        {greenCheck}
        <div>
          <h1>Congratulations</h1>
          <span>You Voted for an NFT</span>
        </div>
      </ContainerThree>
    )}
    <Participants>
      <h1>All Voters ({totalUsersVoted?.length})</h1>
      {totalUsersVoted && totalUsersVoted.length > 0 ? (
        <div className="mb-2">
          {totalUsersVoted?.map((accountId, i) => (
            <a
              href={`/bos.genadrop.near/widget/GenaDrop.Profile.Main?accountId=${accountId}`}
              className="text-decoration-none"
              key={i}
            >
              <Widget
                loading={
                  <div
                    className="placeholder d-inline-block rounded-circle"
                    style={{ width: "3em", height: "3em" }}
                  />
                }
                src="mob.near/widget/ProfileImage"
                props={{
                  accountId,
                  tooltip: true,
                  className: "d-inline-block overflow-hidden",
                  imageClassName: "rounded-circle w-100 h-100",
                }}
              />
            </a>
          ))}
        </div>
      ): <NoVote>
        <p>No Participants at this round</p>
        </NoVote>}
    </Participants>
  </>
);
